# Generated by Django 5.2.1 on 2025-11-05 07:11

import django.contrib.postgres.fields
import django.db.models.deletion
import phonenumber_field.modelfields
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='User',
            fields=[
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('is_deleted', models.BooleanField(db_index=True, default=False, help_text='Soft delete flag - data never actually deleted', verbose_name='is deleted')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='Timestamp when the record was soft deleted', null=True, verbose_name='deleted at')),
                ('deletion_reason', models.TextField(blank=True, help_text='Reason for soft deletion', verbose_name='deletion reason')),
                ('ip_address', models.GenericIPAddressField(blank=True, help_text='IP address of the user who created/updated', null=True, verbose_name='IP address')),
                ('user_agent', models.TextField(blank=True, help_text='Browser/client user agent string', verbose_name='user agent')),
                ('latitude', models.DecimalField(blank=True, decimal_places=8, help_text='Latitude coordinate (-90 to 90)', max_digits=10, null=True, verbose_name='latitude')),
                ('longitude', models.DecimalField(blank=True, decimal_places=8, help_text='Longitude coordinate (-180 to 180)', max_digits=11, null=True, verbose_name='longitude')),
                ('location_accuracy', models.IntegerField(blank=True, help_text='Accuracy in meters', null=True, verbose_name='location accuracy')),
                ('altitude', models.DecimalField(blank=True, decimal_places=2, help_text='Altitude in meters', max_digits=8, null=True, verbose_name='altitude')),
                ('country_code', models.CharField(db_index=True, default='KE', help_text='ISO 3166-1 alpha-2 country code', max_length=2, verbose_name='country code')),
                ('county', models.CharField(blank=True, db_index=True, help_text='County/State/Province', max_length=100, null=True, verbose_name='county/state')),
                ('city', models.CharField(blank=True, db_index=True, help_text='City/Town', max_length=100, null=True, verbose_name='city')),
                ('postal_code', models.CharField(blank=True, help_text='Postal/ZIP code', max_length=20, null=True, verbose_name='postal code')),
                ('phone_number', phonenumber_field.modelfields.PhoneNumberField(db_index=True, help_text='Primary phone number (login credential)', max_length=128, region=None, unique=True, verbose_name='phone number')),
                ('email', models.EmailField(blank=True, db_index=True, help_text='Email address (optional)', max_length=254, null=True, unique=True, verbose_name='email address')),
                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),
                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),
                ('middle_name', models.CharField(blank=True, max_length=150, verbose_name='middle name')),
                ('date_of_birth', models.DateField(blank=True, db_index=True, help_text='Date of birth for age verification', null=True, verbose_name='date of birth')),
                ('gender', models.CharField(blank=True, choices=[('M', 'Male'), ('F', 'Female'), ('O', 'Other'), ('N', 'Prefer not to say')], max_length=1, verbose_name='gender')),
                ('national_id', models.CharField(blank=True, db_index=True, help_text='National ID number (encrypted)', max_length=255, null=True, unique=True, verbose_name='national ID number')),
                ('national_id_hash', models.CharField(blank=True, db_index=True, help_text='SHA-256 hash of national ID for duplicate detection', max_length=64, null=True, unique=True, verbose_name='national ID hash')),
                ('role', models.CharField(choices=[('super_admin', 'Super Administrator'), ('grak_admin', 'GRAK Administrator'), ('grak_officer', 'GRAK Officer'), ('grak_auditor', 'GRAK Auditor'), ('operator_admin', 'Operator Administrator'), ('operator_user', 'Operator User'), ('bematore_admin', 'Bematore Administrator'), ('bematore_analyst', 'Bematore Analyst'), ('citizen', 'Citizen/Player'), ('api_user', 'API User')], db_index=True, default='citizen', help_text='User role in the system', max_length=50, verbose_name='role')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('active', 'Active'), ('inactive', 'Inactive'), ('suspended', 'Suspended'), ('expired', 'Expired'), ('revoked', 'Revoked'), ('completed', 'Completed'), ('failed', 'Failed'), ('cancelled', 'Cancelled'), ('processing', 'Processing')], db_index=True, default='active', max_length=20, verbose_name='status')),
                ('is_phone_verified', models.BooleanField(db_index=True, default=False, verbose_name='phone verified')),
                ('is_email_verified', models.BooleanField(default=False, verbose_name='email verified')),
                ('is_id_verified', models.BooleanField(db_index=True, default=False, verbose_name='ID verified')),
                ('verification_status', models.CharField(choices=[('unverified', 'Unverified'), ('pending', 'Pending Verification'), ('verified', 'Verified'), ('failed', 'Verification Failed'), ('expired', 'Verification Expired'), ('suspended', 'Suspended')], db_index=True, default='unverified', max_length=20, verbose_name='verification status')),
                ('verified_at', models.DateTimeField(blank=True, null=True, verbose_name='verified at')),
                ('language', models.CharField(choices=[('en', 'English'), ('sw', 'Swahili'), ('fr', 'French'), ('ar', 'Arabic'), ('pt', 'Portuguese'), ('am', 'Amharic'), ('ha', 'Hausa'), ('yo', 'Yoruba'), ('ig', 'Igbo'), ('zu', 'Zulu'), ('af', 'Afrikaans'), ('pcm', 'Nigerian Pidgin')], default='en', max_length=10, verbose_name='preferred language')),
                ('timezone_name', models.CharField(default='Africa/Nairobi', max_length=50, verbose_name='timezone')),
                ('notification_preferences', models.JSONField(blank=True, default=dict, help_text='SMS, email, push notification preferences', verbose_name='notification preferences')),
                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active', verbose_name='active')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into admin site', verbose_name='staff status')),
                ('is_locked', models.BooleanField(db_index=True, default=False, help_text='Account locked due to failed login attempts', verbose_name='account locked')),
                ('locked_until', models.DateTimeField(blank=True, null=True, verbose_name='locked until')),
                ('failed_login_attempts', models.PositiveIntegerField(default=0, verbose_name='failed login attempts')),
                ('last_login_at', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('last_login_ip', models.GenericIPAddressField(blank=True, null=True, verbose_name='last login IP')),
                ('is_2fa_enabled', models.BooleanField(default=False, verbose_name='2FA enabled')),
                ('totp_secret', models.CharField(blank=True, help_text='Encrypted TOTP secret for 2FA', max_length=255, verbose_name='TOTP secret')),
                ('backup_codes', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=20), blank=True, default=list, help_text='Backup codes for 2FA recovery', size=None)),
                ('terms_accepted', models.BooleanField(default=False, verbose_name='terms accepted')),
                ('terms_accepted_at', models.DateTimeField(blank=True, null=True, verbose_name='terms accepted at')),
                ('privacy_policy_accepted', models.BooleanField(default=False, verbose_name='privacy policy accepted')),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional metadata for flexibility', verbose_name='metadata')),
                ('created_by', models.ForeignKey(blank=True, help_text='User who created this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, help_text='User who soft deleted this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_deletions', to=settings.AUTH_USER_MODEL)),
                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to. A user will get all permissions granted to each of their groups.', related_name='user_set', related_query_name='user', to='auth.group', verbose_name='groups')),
                ('updated_by', models.ForeignKey(blank=True, help_text='User who last updated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='user_set', related_query_name='user', to='auth.permission', verbose_name='user permissions')),
            ],
            options={
                'verbose_name': 'User',
                'verbose_name_plural': 'Users',
                'db_table': 'users',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='IdentityVerification',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('is_deleted', models.BooleanField(db_index=True, default=False, help_text='Soft delete flag - data never actually deleted', verbose_name='is deleted')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='Timestamp when the record was soft deleted', null=True, verbose_name='deleted at')),
                ('deletion_reason', models.TextField(blank=True, help_text='Reason for soft deletion', verbose_name='deletion reason')),
                ('ip_address', models.GenericIPAddressField(blank=True, help_text='IP address of the user who created/updated', null=True, verbose_name='IP address')),
                ('user_agent', models.TextField(blank=True, help_text='Browser/client user agent string', verbose_name='user agent')),
                ('verification_type', models.CharField(choices=[('phone', 'Phone Number'), ('email', 'Email Address'), ('national_id', 'National ID'), ('passport', 'Passport'), ('biometric', 'Biometric'), ('iprs', 'IPRS Integration')], db_index=True, max_length=20, verbose_name='verification type')),
                ('status', models.CharField(choices=[('unverified', 'Unverified'), ('pending', 'Pending Verification'), ('verified', 'Verified'), ('failed', 'Verification Failed'), ('expired', 'Verification Expired'), ('suspended', 'Suspended')], db_index=True, default='pending', max_length=20, verbose_name='status')),
                ('verification_data', models.JSONField(blank=True, default=dict, help_text='Encrypted verification data', verbose_name='verification data')),
                ('verification_code', models.CharField(blank=True, max_length=10, verbose_name='verification code')),
                ('code_expires_at', models.DateTimeField(blank=True, null=True, verbose_name='code expires at')),
                ('attempts', models.PositiveSmallIntegerField(default=0, verbose_name='attempts')),
                ('max_attempts', models.PositiveSmallIntegerField(default=3, verbose_name='max attempts')),
                ('verified_at', models.DateTimeField(blank=True, null=True, verbose_name='verified at')),
                ('expires_at', models.DateTimeField(blank=True, help_text='Verification expiry date', null=True, verbose_name='expires at')),
                ('failure_reason', models.TextField(blank=True, verbose_name='failure reason')),
                ('external_reference', models.CharField(blank=True, help_text='External system reference (e.g., IPRS reference)', max_length=255, verbose_name='external reference')),
                ('created_by', models.ForeignKey(blank=True, help_text='User who created this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, help_text='User who soft deleted this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_deletions', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, help_text='User who last updated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='verifications', to=settings.AUTH_USER_MODEL)),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verifications_performed', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Identity Verification',
                'verbose_name_plural': 'Identity Verifications',
                'db_table': 'identity_verifications',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='UserActivityLog',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('activity_type', models.CharField(db_index=True, help_text='Type of activity performed', max_length=50, verbose_name='activity type')),
                ('action', models.CharField(db_index=True, max_length=100, verbose_name='action')),
                ('description', models.TextField(blank=True, verbose_name='description')),
                ('activity_data', models.JSONField(blank=True, default=dict, help_text='Additional activity metadata', verbose_name='activity data')),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True, verbose_name='IP address')),
                ('user_agent', models.TextField(blank=True, verbose_name='user agent')),
                ('status', models.CharField(choices=[('success', 'Success'), ('failed', 'Failed'), ('pending', 'Pending')], db_index=True, default='success', max_length=20, verbose_name='status')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activity_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Activity Log',
                'verbose_name_plural': 'User Activity Logs',
                'db_table': 'user_activity_logs',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='UserDevice',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('is_deleted', models.BooleanField(db_index=True, default=False, help_text='Soft delete flag - data never actually deleted', verbose_name='is deleted')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='Timestamp when the record was soft deleted', null=True, verbose_name='deleted at')),
                ('deletion_reason', models.TextField(blank=True, help_text='Reason for soft deletion', verbose_name='deletion reason')),
                ('ip_address', models.GenericIPAddressField(blank=True, help_text='IP address of the user who created/updated', null=True, verbose_name='IP address')),
                ('user_agent', models.TextField(blank=True, help_text='Browser/client user agent string', verbose_name='user agent')),
                ('device_id', models.CharField(db_index=True, help_text='Unique device identifier', max_length=255, unique=True, verbose_name='device ID')),
                ('device_name', models.CharField(blank=True, max_length=100, verbose_name='device name')),
                ('device_type', models.CharField(choices=[('mobile', 'Mobile'), ('tablet', 'Tablet'), ('desktop', 'Desktop'), ('other', 'Other')], default='mobile', max_length=20, verbose_name='device type')),
                ('os_name', models.CharField(blank=True, max_length=50, verbose_name='OS name')),
                ('os_version', models.CharField(blank=True, max_length=50, verbose_name='OS version')),
                ('browser_name', models.CharField(blank=True, max_length=50, verbose_name='browser name')),
                ('browser_version', models.CharField(blank=True, max_length=50, verbose_name='browser version')),
                ('is_trusted', models.BooleanField(db_index=True, default=False, verbose_name='trusted device')),
                ('trusted_at', models.DateTimeField(blank=True, null=True, verbose_name='trusted at')),
                ('is_blocked', models.BooleanField(db_index=True, default=False, verbose_name='blocked')),
                ('blocked_reason', models.TextField(blank=True, verbose_name='blocked reason')),
                ('first_seen_at', models.DateTimeField(auto_now_add=True, verbose_name='first seen')),
                ('last_seen_at', models.DateTimeField(blank=True, null=True, verbose_name='last seen')),
                ('login_count', models.PositiveIntegerField(default=0, verbose_name='login count')),
                ('last_ip_address', models.GenericIPAddressField(blank=True, null=True, verbose_name='last IP address')),
                ('last_location_country', models.CharField(blank=True, max_length=2, verbose_name='last location country')),
                ('last_location_city', models.CharField(blank=True, max_length=100, verbose_name='last location city')),
                ('created_by', models.ForeignKey(blank=True, help_text='User who created this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, help_text='User who soft deleted this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_deletions', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, help_text='User who last updated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='devices', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Device',
                'verbose_name_plural': 'User Devices',
                'db_table': 'user_devices',
                'ordering': ['-last_seen_at'],
            },
        ),
        migrations.CreateModel(
            name='LoginHistory',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('login_at', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='login at')),
                ('logout_at', models.DateTimeField(blank=True, null=True, verbose_name='logout at')),
                ('session_duration', models.DurationField(blank=True, null=True, verbose_name='session duration')),
                ('login_successful', models.BooleanField(db_index=True, default=True, verbose_name='login successful')),
                ('failure_reason', models.CharField(blank=True, max_length=255, verbose_name='failure reason')),
                ('auth_method', models.CharField(choices=[('password', 'Password'), ('otp', 'OTP'), ('2fa', 'Two-Factor Auth'), ('biometric', 'Biometric'), ('api_key', 'API Key')], default='password', max_length=20, verbose_name='authentication method')),
                ('ip_address', models.GenericIPAddressField(db_index=True, verbose_name='IP address')),
                ('user_agent', models.TextField(blank=True, verbose_name='user agent')),
                ('country_code', models.CharField(blank=True, db_index=True, max_length=2, verbose_name='country code')),
                ('city', models.CharField(blank=True, max_length=100, verbose_name='city')),
                ('latitude', models.DecimalField(blank=True, decimal_places=8, max_digits=10, null=True, verbose_name='latitude')),
                ('longitude', models.DecimalField(blank=True, decimal_places=8, max_digits=11, null=True, verbose_name='longitude')),
                ('risk_score', models.DecimalField(decimal_places=2, default=0.0, help_text='Calculated risk score (0-100)', max_digits=5, verbose_name='risk score')),
                ('is_suspicious', models.BooleanField(db_index=True, default=False, verbose_name='suspicious')),
                ('suspicious_reasons', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), blank=True, default=list, size=None)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='login_history', to=settings.AUTH_USER_MODEL)),
                ('device', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='logins', to='users.userdevice')),
            ],
            options={
                'verbose_name': 'Login History',
                'verbose_name_plural': 'Login Histories',
                'db_table': 'login_history',
                'ordering': ['-login_at'],
            },
        ),
        migrations.CreateModel(
            name='UserProfile',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('is_deleted', models.BooleanField(db_index=True, default=False, help_text='Soft delete flag - data never actually deleted', verbose_name='is deleted')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='Timestamp when the record was soft deleted', null=True, verbose_name='deleted at')),
                ('deletion_reason', models.TextField(blank=True, help_text='Reason for soft deletion', verbose_name='deletion reason')),
                ('ip_address', models.GenericIPAddressField(blank=True, help_text='IP address of the user who created/updated', null=True, verbose_name='IP address')),
                ('user_agent', models.TextField(blank=True, help_text='Browser/client user agent string', verbose_name='user agent')),
                ('avatar', models.ImageField(blank=True, null=True, upload_to='avatars/%Y/%m/%d/', verbose_name='avatar')),
                ('bio', models.TextField(blank=True, max_length=500, verbose_name='bio')),
                ('occupation', models.CharField(blank=True, max_length=100, verbose_name='occupation')),
                ('employer', models.CharField(blank=True, max_length=100, verbose_name='employer')),
                ('secondary_phone', models.CharField(blank=True, max_length=20, verbose_name='secondary phone')),
                ('secondary_email', models.EmailField(blank=True, max_length=254, verbose_name='secondary email')),
                ('address_line1', models.CharField(blank=True, max_length=255, verbose_name='address line 1')),
                ('address_line2', models.CharField(blank=True, max_length=255, verbose_name='address line 2')),
                ('emergency_contact_name', models.CharField(blank=True, max_length=150, verbose_name='emergency contact name')),
                ('emergency_contact_phone', models.CharField(blank=True, max_length=20, verbose_name='emergency contact phone')),
                ('emergency_contact_relationship', models.CharField(blank=True, max_length=50, verbose_name='emergency contact relationship')),
                ('profile_completion_percentage', models.PositiveSmallIntegerField(default=0, help_text='Percentage of profile fields filled', verbose_name='profile completion')),
                ('created_by', models.ForeignKey(blank=True, help_text='User who created this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, help_text='User who soft deleted this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_deletions', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, help_text='User who last updated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Profile',
                'verbose_name_plural': 'User Profiles',
                'db_table': 'user_profiles',
            },
        ),
        migrations.CreateModel(
            name='UserSession',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('session_key', models.CharField(db_index=True, max_length=255, unique=True, verbose_name='session key')),
                ('session_data', models.JSONField(blank=True, default=dict, verbose_name='session data')),
                ('is_active', models.BooleanField(db_index=True, default=True, verbose_name='active')),
                ('expires_at', models.DateTimeField(db_index=True, verbose_name='expires at')),
                ('last_activity_at', models.DateTimeField(auto_now=True, verbose_name='last activity')),
                ('ip_address', models.GenericIPAddressField(verbose_name='IP address')),
                ('user_agent', models.TextField(blank=True, verbose_name='user agent')),
                ('device', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='users.userdevice')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sessions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Session',
                'verbose_name_plural': 'User Sessions',
                'db_table': 'user_sessions',
                'ordering': ['-last_activity_at'],
            },
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['phone_number', 'is_active'], name='user_phone_active_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['email', 'is_active'], name='user_email_active_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['role', 'status'], name='user_role_status_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['verification_status'], name='user_verification_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['is_locked', 'locked_until'], name='user_locked_idx'),
        ),
        migrations.AddIndex(
            model_name='identityverification',
            index=models.Index(fields=['user', 'verification_type'], name='verif_user_type_idx'),
        ),
        migrations.AddIndex(
            model_name='identityverification',
            index=models.Index(fields=['status', 'created_at'], name='verif_status_time_idx'),
        ),
        migrations.AddIndex(
            model_name='useractivitylog',
            index=models.Index(fields=['user', 'activity_type'], name='activity_user_type_idx'),
        ),
        migrations.AddIndex(
            model_name='useractivitylog',
            index=models.Index(fields=['activity_type', 'created_at'], name='activity_type_time_idx'),
        ),
        migrations.AddIndex(
            model_name='userdevice',
            index=models.Index(fields=['user', 'is_trusted'], name='device_user_trust_idx'),
        ),
        migrations.AddIndex(
            model_name='userdevice',
            index=models.Index(fields=['device_id', 'is_blocked'], name='device_id_block_idx'),
        ),
        migrations.AddIndex(
            model_name='loginhistory',
            index=models.Index(fields=['user', 'login_at'], name='login_user_time_idx'),
        ),
        migrations.AddIndex(
            model_name='loginhistory',
            index=models.Index(fields=['ip_address', 'login_at'], name='login_ip_time_idx'),
        ),
        migrations.AddIndex(
            model_name='loginhistory',
            index=models.Index(fields=['is_suspicious'], name='login_suspicious_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['user', 'is_active'], name='session_user_active_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['session_key'], name='session_key_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['expires_at'], name='session_expires_idx'),
        ),
    ]
