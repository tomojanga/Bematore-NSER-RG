# Generated by Django 5.2.1 on 2025-11-05 07:11

import django.utils.timezone
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='ExclusionAuditLog',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('action', models.CharField(choices=[('created', 'Created'), ('updated', 'Updated'), ('activated', 'Activated'), ('expired', 'Expired'), ('renewed', 'Renewed'), ('terminated', 'Terminated Early'), ('suspended', 'Suspended'), ('revoked', 'Revoked'), ('viewed', 'Viewed'), ('propagated', 'Propagated to Operators')], db_index=True, max_length=50, verbose_name='action')),
                ('description', models.TextField(blank=True, verbose_name='description')),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True, verbose_name='IP address')),
                ('user_agent', models.TextField(blank=True, verbose_name='user agent')),
                ('changes', models.JSONField(blank=True, default=dict, help_text='Before/after values for updates', verbose_name='changes')),
                ('metadata', models.JSONField(blank=True, default=dict, verbose_name='metadata')),
            ],
            options={
                'verbose_name': 'Exclusion Audit Log',
                'verbose_name_plural': 'Exclusion Audit Logs',
                'db_table': 'nser_exclusion_audit_logs',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ExclusionExtensionRequest',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('is_deleted', models.BooleanField(db_index=True, default=False, help_text='Soft delete flag - data never actually deleted', verbose_name='is deleted')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='Timestamp when the record was soft deleted', null=True, verbose_name='deleted at')),
                ('deletion_reason', models.TextField(blank=True, help_text='Reason for soft deletion', verbose_name='deletion reason')),
                ('ip_address', models.GenericIPAddressField(blank=True, help_text='IP address of the user who created/updated', null=True, verbose_name='IP address')),
                ('user_agent', models.TextField(blank=True, help_text='Browser/client user agent string', verbose_name='user agent')),
                ('requested_new_period', models.CharField(choices=[('6_months', '6 Months'), ('1_year', '1 Year'), ('5_years', '5 Years'), ('permanent', 'Permanent (5 years with auto-renewal)'), ('custom', 'Custom Period')], max_length=20, verbose_name='requested new period')),
                ('requested_expiry_date', models.DateTimeField(verbose_name='requested expiry date')),
                ('reason', models.TextField(blank=True, verbose_name='reason for extension')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('approved', 'Approved'), ('rejected', 'Rejected')], db_index=True, default='pending', max_length=20, verbose_name='status')),
                ('reviewed_at', models.DateTimeField(blank=True, null=True, verbose_name='reviewed at')),
                ('review_notes', models.TextField(blank=True, verbose_name='review notes')),
            ],
            options={
                'verbose_name': 'Exclusion Extension Request',
                'verbose_name_plural': 'Exclusion Extension Requests',
                'db_table': 'nser_exclusion_extension_requests',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ExclusionStatistics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('date', models.DateField(db_index=True, unique=True, verbose_name='date')),
                ('total_exclusions', models.PositiveIntegerField(default=0, verbose_name='total exclusions')),
                ('active_exclusions', models.PositiveIntegerField(default=0, verbose_name='active exclusions')),
                ('new_exclusions_today', models.PositiveIntegerField(default=0, verbose_name='new exclusions today')),
                ('expired_exclusions_today', models.PositiveIntegerField(default=0, verbose_name='expired today')),
                ('six_month_exclusions', models.PositiveIntegerField(default=0, verbose_name='6 month')),
                ('one_year_exclusions', models.PositiveIntegerField(default=0, verbose_name='1 year')),
                ('five_year_exclusions', models.PositiveIntegerField(default=0, verbose_name='5 years')),
                ('permanent_exclusions', models.PositiveIntegerField(default=0, verbose_name='permanent')),
                ('high_risk_exclusions', models.PositiveIntegerField(default=0, verbose_name='high risk')),
                ('moderate_risk_exclusions', models.PositiveIntegerField(default=0, verbose_name='moderate risk')),
                ('low_risk_exclusions', models.PositiveIntegerField(default=0, verbose_name='low risk')),
                ('exclusions_by_county', models.JSONField(blank=True, default=dict, verbose_name='by county')),
                ('avg_propagation_time_seconds', models.FloatField(default=0.0, verbose_name='avg propagation time')),
                ('successful_propagations', models.PositiveIntegerField(default=0, verbose_name='successful propagations')),
                ('failed_propagations', models.PositiveIntegerField(default=0, verbose_name='failed propagations')),
            ],
            options={
                'verbose_name': 'Exclusion Statistics',
                'verbose_name_plural': 'Exclusion Statistics',
                'db_table': 'nser_exclusion_statistics',
                'ordering': ['-date'],
            },
        ),
        migrations.CreateModel(
            name='OperatorExclusionMapping',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('notified_at', models.DateTimeField(blank=True, db_index=True, null=True, verbose_name='notified at')),
                ('acknowledged_at', models.DateTimeField(blank=True, db_index=True, null=True, verbose_name='acknowledged at')),
                ('propagation_status', models.CharField(choices=[('pending', 'Pending'), ('notified', 'Notified'), ('acknowledged', 'Acknowledged'), ('failed', 'Failed'), ('timeout', 'Timeout')], db_index=True, default='pending', max_length=20, verbose_name='propagation status')),
                ('retry_count', models.PositiveSmallIntegerField(default=0, verbose_name='retry count')),
                ('max_retries', models.PositiveSmallIntegerField(default=9, verbose_name='max retries')),
                ('next_retry_at', models.DateTimeField(blank=True, null=True, verbose_name='next retry at')),
                ('webhook_sent_at', models.DateTimeField(blank=True, null=True, verbose_name='webhook sent at')),
                ('webhook_response_code', models.PositiveSmallIntegerField(blank=True, null=True, verbose_name='webhook response code')),
                ('webhook_response_body', models.TextField(blank=True, verbose_name='webhook response body')),
                ('last_error_message', models.TextField(blank=True, verbose_name='last error message')),
                ('error_count', models.PositiveSmallIntegerField(default=0, verbose_name='error count')),
                ('is_compliant', models.BooleanField(db_index=True, default=False, help_text='Whether operator has properly acknowledged and implemented exclusion', verbose_name='is compliant')),
                ('compliance_checked_at', models.DateTimeField(blank=True, null=True, verbose_name='compliance checked at')),
            ],
            options={
                'verbose_name': 'Operator Exclusion Mapping',
                'verbose_name_plural': 'Operator Exclusion Mappings',
                'db_table': 'nser_operator_exclusion_mappings',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='SelfExclusionRecord',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='Timestamp when the record was created', verbose_name='created at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True, help_text='Timestamp when the record was last updated', verbose_name='updated at')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Globally unique identifier', primary_key=True, serialize=False)),
                ('is_deleted', models.BooleanField(db_index=True, default=False, help_text='Soft delete flag - data never actually deleted', verbose_name='is deleted')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='Timestamp when the record was soft deleted', null=True, verbose_name='deleted at')),
                ('deletion_reason', models.TextField(blank=True, help_text='Reason for soft deletion', verbose_name='deletion reason')),
                ('ip_address', models.GenericIPAddressField(blank=True, help_text='IP address of the user who created/updated', null=True, verbose_name='IP address')),
                ('user_agent', models.TextField(blank=True, help_text='Browser/client user agent string', verbose_name='user agent')),
                ('latitude', models.DecimalField(blank=True, decimal_places=8, help_text='Latitude coordinate (-90 to 90)', max_digits=10, null=True, verbose_name='latitude')),
                ('longitude', models.DecimalField(blank=True, decimal_places=8, help_text='Longitude coordinate (-180 to 180)', max_digits=11, null=True, verbose_name='longitude')),
                ('location_accuracy', models.IntegerField(blank=True, help_text='Accuracy in meters', null=True, verbose_name='location accuracy')),
                ('altitude', models.DecimalField(blank=True, decimal_places=2, help_text='Altitude in meters', max_digits=8, null=True, verbose_name='altitude')),
                ('country_code', models.CharField(db_index=True, default='KE', help_text='ISO 3166-1 alpha-2 country code', max_length=2, verbose_name='country code')),
                ('county', models.CharField(blank=True, db_index=True, help_text='County/State/Province', max_length=100, null=True, verbose_name='county/state')),
                ('city', models.CharField(blank=True, db_index=True, help_text='City/Town', max_length=100, null=True, verbose_name='city')),
                ('postal_code', models.CharField(blank=True, help_text='Postal/ZIP code', max_length=20, null=True, verbose_name='postal code')),
                ('exclusion_reference', models.CharField(db_index=True, help_text='Unique exclusion reference number', max_length=50, unique=True, verbose_name='exclusion reference')),
                ('exclusion_period', models.CharField(choices=[('6_months', '6 Months'), ('1_year', '1 Year'), ('5_years', '5 Years'), ('permanent', 'Permanent (5 years with auto-renewal)'), ('custom', 'Custom Period')], db_index=True, max_length=20, verbose_name='exclusion period')),
                ('custom_period_days', models.PositiveIntegerField(blank=True, help_text='Custom exclusion period in days', null=True, verbose_name='custom period days')),
                ('effective_date', models.DateTimeField(db_index=True, default=django.utils.timezone.now, help_text='When exclusion becomes active', verbose_name='effective date')),
                ('expiry_date', models.DateTimeField(db_index=True, help_text='When exclusion ends', verbose_name='expiry date')),
                ('actual_end_date', models.DateTimeField(blank=True, help_text='Actual date exclusion ended (for early termination)', null=True, verbose_name='actual end date')),
                ('is_auto_renewable', models.BooleanField(default=False, help_text='Automatically renew after expiry (permanent exclusions)', verbose_name='auto-renewable')),
                ('renewal_count', models.PositiveIntegerField(default=0, help_text='Number of times auto-renewed', verbose_name='renewal count')),
                ('last_renewed_at', models.DateTimeField(blank=True, null=True, verbose_name='last renewed at')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('active', 'Active'), ('expired', 'Expired'), ('terminated', 'Terminated Early'), ('suspended', 'Suspended'), ('revoked', 'Revoked')], db_index=True, default='pending', max_length=20, verbose_name='status')),
                ('is_active', models.BooleanField(db_index=True, default=True, help_text='Quick lookup for active exclusions', verbose_name='is active')),
                ('reason', models.TextField(blank=True, help_text='User-provided reason for self-exclusion', verbose_name='reason for exclusion')),
                ('motivation_type', models.CharField(blank=True, choices=[('financial_loss', 'Financial Loss'), ('relationship_issues', 'Relationship Issues'), ('mental_health', 'Mental Health'), ('addiction', 'Addiction Concerns'), ('precaution', 'Precautionary Measure'), ('other', 'Other')], max_length=50, verbose_name='motivation type')),
                ('risk_level_at_exclusion', models.CharField(blank=True, choices=[('none', 'No Risk'), ('low', 'Low Risk'), ('mild', 'Mild Risk'), ('moderate', 'Moderate Risk'), ('high', 'High Risk'), ('severe', 'Severe Risk'), ('critical', 'Critical Risk'), ('blacklisted', 'Blacklisted')], db_index=True, max_length=20, verbose_name='risk level at exclusion')),
                ('terms_accepted', models.BooleanField(default=True, verbose_name='terms accepted')),
                ('consent_recorded_at', models.DateTimeField(auto_now_add=True, verbose_name='consent recorded at')),
                ('consent_ip_address', models.GenericIPAddressField(blank=True, null=True, verbose_name='consent IP address')),
                ('digital_signature', models.TextField(blank=True, help_text='Cryptographic signature of consent', verbose_name='digital signature')),
                ('propagation_status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('partial', 'Partial'), ('failed', 'Failed')], db_index=True, default='pending', max_length=20, verbose_name='propagation status')),
                ('operators_notified', models.PositiveIntegerField(default=0, verbose_name='operators notified')),
                ('operators_acknowledged', models.PositiveIntegerField(default=0, verbose_name='operators acknowledged')),
                ('propagation_completed_at', models.DateTimeField(blank=True, null=True, verbose_name='propagation completed at')),
                ('can_terminate_early', models.BooleanField(default=False, help_text='Whether user can request early termination', verbose_name='can terminate early')),
                ('early_termination_request_date', models.DateTimeField(blank=True, null=True, verbose_name='early termination request date')),
                ('early_termination_approved', models.BooleanField(default=False, verbose_name='early termination approved')),
                ('termination_reason', models.TextField(blank=True, verbose_name='termination reason')),
                ('notification_sent', models.BooleanField(default=False, verbose_name='confirmation notification sent')),
                ('notification_sent_at', models.DateTimeField(blank=True, null=True, verbose_name='notification sent at')),
                ('reminder_notifications_enabled', models.BooleanField(default=True, help_text='Send reminders before expiry', verbose_name='reminder notifications enabled')),
                ('metadata', models.JSONField(blank=True, default=dict, verbose_name='metadata')),
            ],
            options={
                'verbose_name': 'Self-Exclusion Record',
                'verbose_name_plural': 'Self-Exclusion Records',
                'db_table': 'nser_exclusion_records',
                'ordering': ['-effective_date'],
            },
        ),
    ]
